\documentclass[conference]{./sty/IEEEtran}
% Some very useful LaTeX packages include:
% (uncomment the ones you want to load)


% *** MISC UTILITY PACKAGES ***
%
%\usepackage{ifpdf}
% Heiko Oberdiek's ifpdf.sty is very useful if you need conditional
% compilation based on whether the output is pdf or dvi.
% usage:
% \ifpdf
%   % pdf code
% \else
%   % dvi code
% \fi
% The latest version of ifpdf.sty can be obtained from:
% http://www.ctan.org/tex-archive/macros/latex/contrib/oberdiek/
% Also, note that IEEEtran.cls V1.7 and later provides a builtin
% \ifCLASSINFOpdf conditional that works the same way.
% When switching from latex to pdflatex and vice-versa, the compiler may
% have to be run twice to clear warning/error messages.






% *** CITATION PACKAGES ***
%
\usepackage{cite}
% cite.sty was written by Donald Arseneau
% V1.6 and later of IEEEtran pre-defines the format of the cite.sty package
% \cite{} output to follow that of IEEE. Loading the cite package will
% result in citation numbers being automatically sorted and properly
% "compressed/ranged". e.g., [1], [9], [2], [7], [5], [6] without using
% cite.sty will become [1], [2], [5]--[7], [9] using cite.sty. cite.sty's
% \cite will automatically add leading space, if needed. Use cite.sty's
% noadjust option (cite.sty V3.8 and later) if you want to turn this off.
% cite.sty is already installed on most LaTeX systems. Be sure and use
% version 4.0 (2003-05-27) and later if using hyperref.sty. cite.sty does
% not currently provide for hyperlinked citations.
% The latest version can be obtained at:
% http://www.ctan.org/tex-archive/macros/latex/contrib/cite/
% The documentation is contained in the cite.sty file itself.






% *** GRAPHICS RELATED PACKAGES ***
%
\ifCLASSINFOpdf
  % \usepackage[pdftex]{graphicx}
  % declare the path(s) where your graphic files are
  % \graphicspath{{../pdf/}{../jpeg/}}
  % and their extensions so you won't have to specify these with
  % every instance of \includegraphics
  % \DeclareGraphicsExtensions{.pdf,.jpeg,.png}
\else
  % or other class option (dvipsone, dvipdf, if not using dvips). graphicx
  % will default to the driver specified in the system graphics.cfg if no
  % driver is specified.
  % \usepackage[dvips]{graphicx}
  % declare the path(s) where your graphic files are
  % \graphicspath{{../eps/}}
  % and their extensions so you won't have to specify these with
  % every instance of \includegraphics
  % \DeclareGraphicsExtensions{.eps}
\fi
% graphicx was written by David Carlisle and Sebastian Rahtz. It is
% required if you want graphics, photos, etc. graphicx.sty is already
% installed on most LaTeX systems. The latest version and documentation can
% be obtained at: 
% http://www.ctan.org/tex-archive/macros/latex/required/graphics/
% Another good source of documentation is "Using Imported Graphics in
% LaTeX2e" by Keith Reckdahl which can be found as epslatex.ps or
% epslatex.pdf at: http://www.ctan.org/tex-archive/info/
%
% latex, and pdflatex in dvi mode, support graphics in encapsulated
% postscript (.eps) format. pdflatex in pdf mode supports graphics
% in .pdf, .jpeg, .png and .mps (metapost) formats. Users should ensure
% that all non-photo figures use a vector format (.eps, .pdf, .mps) and
% not a bitmapped formats (.jpeg, .png). IEEE frowns on bitmapped formats
% which can result in "jaggedy"/blurry rendering of lines and letters as
% well as large increases in file sizes.
%
% You can find documentation about the pdfTeX application at:
% http://www.tug.org/applications/pdftex





% *** MATH PACKAGES ***
%
%\usepackage[cmex10]{amsmath}
% A popular package from the American Mathematical Society that provides
% many useful and powerful commands for dealing with mathematics. If using
% it, be sure to load this package with the cmex10 option to ensure that
% only type 1 fonts will utilized at all point sizes. Without this option,
% it is possible that some math symbols, particularly those within
% footnotes, will be rendered in bitmap form which will result in a
% document that can not be IEEE Xplore compliant!
%
% Also, note that the amsmath package sets \interdisplaylinepenalty to 10000
% thus preventing page breaks from occurring within multiline equations. Use:
%\interdisplaylinepenalty=2500
% after loading amsmath to restore such page breaks as IEEEtran.cls normally
% does. amsmath.sty is already installed on most LaTeX systems. The latest
% version and documentation can be obtained at:
% http://www.ctan.org/tex-archive/macros/latex/required/amslatex/math/





% *** SPECIALIZED LIST PACKAGES ***
%
%\usepackage{algorithmic}
% algorithmic.sty was written by Peter Williams and Rogerio Brito.
% This package provides an algorithmic environment fo describing algorithms.
% You can use the algorithmic environment in-text or within a figure
% environment to provide for a floating algorithm. Do NOT use the algorithm
% floating environment provided by algorithm.sty (by the same authors) or
% algorithm2e.sty (by Christophe Fiorio) as IEEE does not use dedicated
% algorithm float types and packages that provide these will not provide
% correct IEEE style captions. The latest version and documentation of
% algorithmic.sty can be obtained at:
% http://www.ctan.org/tex-archive/macros/latex/contrib/algorithms/
% There is also a support site at:
% http://algorithms.berlios.de/index.html
% Also of interest may be the (relatively newer and more customizable)
% algorithmicx.sty package by Szasz Janos:
% http://www.ctan.org/tex-archive/macros/latex/contrib/algorithmicx/




% *** ALIGNMENT PACKAGES ***
%
%\usepackage{array}
% Frank Mittelbach's and David Carlisle's array.sty patches and improves
% the standard LaTeX2e array and tabular environments to provide better
% appearance and additional user controls. As the default LaTeX2e table
% generation code is lacking to the point of almost being broken with
% respect to the quality of the end results, all users are strongly
% advised to use an enhanced (at the very least that provided by array.sty)
% set of table tools. array.sty is already installed on most systems. The
% latest version and documentation can be obtained at:
% http://www.ctan.org/tex-archive/macros/latex/required/tools/


%\usepackage{mdwmath}
%\usepackage{mdwtab}
% Also highly recommended is Mark Wooding's extremely powerful MDW tools,
% especially mdwmath.sty and mdwtab.sty which are used to format equations
% and tables, respectively. The MDWtools set is already installed on most
% LaTeX systems. The lastest version and documentation is available at:
% http://www.ctan.org/tex-archive/macros/latex/contrib/mdwtools/


% IEEEtran contains the IEEEeqnarray family of commands that can be used to
% generate multiline equations as well as matrices, tables, etc., of high
% quality.


%\usepackage{eqparbox}
% Also of notable interest is Scott Pakin's eqparbox package for creating
% (automatically sized) equal width boxes - aka "natural width parboxes".
% Available at:
% http://www.ctan.org/tex-archive/macros/latex/contrib/eqparbox/





% *** SUBFIGURE PACKAGES ***
%\usepackage[tight,footnotesize]{subfigure}
% subfigure.sty was written by Steven Douglas Cochran. This package makes it
% easy to put subfigures in your figures. e.g., "Figure 1a and 1b". For IEEE
% work, it is a good idea to load it with the tight package option to reduce
% the amount of white space around the subfigures. subfigure.sty is already
% installed on most LaTeX systems. The latest version and documentation can
% be obtained at:
% http://www.ctan.org/tex-archive/obsolete/macros/latex/contrib/subfigure/
% subfigure.sty has been superceeded by subfig.sty.



\usepackage{caption}
%\usepackage[font=footnotesize]{subfig}
% subfig.sty, also written by Steven Douglas Cochran, is the modern
% replacement for subfigure.sty. However, subfig.sty requires and
% automatically loads Axel Sommerfeldt's caption.sty which will override
% IEEEtran.cls handling of captions and this will result in nonIEEE style
% figure/table captions. To prevent this problem, be sure and preload
% caption.sty with its "caption=false" package option. This is will preserve
% IEEEtran.cls handing of captions. Version 1.3 (2005/06/28) and later 
% (recommended due to many improvements over 1.2) of subfig.sty supports
% the caption=false option directly:
%\usepackage[caption=false,font=footnotesize]{subfig}
%
% The latest version and documentation can be obtained at:
% http://www.ctan.org/tex-archive/macros/latex/contrib/subfig/
% The latest version and documentation of caption.sty can be obtained at:
% http://www.ctan.org/tex-archive/macros/latex/contrib/caption/




% *** FLOAT PACKAGES ***
%
%\usepackage{fixltx2e}
% fixltx2e, the successor to the earlier fix2col.sty, was written by
% Frank Mittelbach and David Carlisle. This package corrects a few problems
% in the LaTeX2e kernel, the most notable of which is that in current
% LaTeX2e releases, the ordering of single and double column floats is not
% guaranteed to be preserved. Thus, an unpatched LaTeX2e can allow a
% single column figure to be placed prior to an earlier double column
% figure. The latest version and documentation can be found at:
% http://www.ctan.org/tex-archive/macros/latex/base/



%\usepackage{stfloats}
% stfloats.sty was written by Sigitas Tolusis. This package gives LaTeX2e
% the ability to do double column floats at the bottom of the page as well
% as the top. (e.g., "\begin{figure*}[!b]" is not normally possible in
% LaTeX2e). It also provides a command:
%\fnbelowfloat
% to enable the placement of footnotes below bottom floats (the standard
% LaTeX2e kernel puts them above bottom floats). This is an invasive package
% which rewrites many portions of the LaTeX2e float routines. It may not work
% with other packages that modify the LaTeX2e float routines. The latest
% version and documentation can be obtained at:
% http://www.ctan.org/tex-archive/macros/latex/contrib/sttools/
% Documentation is contained in the stfloats.sty comments as well as in the
% presfull.pdf file. Do not use the stfloats baselinefloat ability as IEEE
% does not allow \baselineskip to stretch. Authors submitting work to the
% IEEE should note that IEEE rarely uses double column equations and
% that authors should try to avoid such use. Do not be tempted to use the
% cuted.sty or midfloat.sty packages (also by Sigitas Tolusis) as IEEE does
% not format its papers in such ways.





% *** PDF, URL AND HYPERLINK PACKAGES ***
%
\usepackage{url}
% url.sty was written by Donald Arseneau. It provides better support for
% handling and breaking URLs. url.sty is already installed on most LaTeX
% systems. The latest version can be obtained at:
% http://www.ctan.org/tex-archive/macros/latex/contrib/misc/
% Read the url.sty source comments for usage information. Basically,
% \url{my_url_here}.

% *** Do not adjust lengths that control margins, column widths, etc. ***
% *** Do not use packages that alter fonts (such as pslatex).         ***
% There should be no need to do such things with IEEEtran.cls V1.6 and later.
% (Unless specifically asked to do so by the journal or conference you plan
% to submit to, of course. )

\usepackage{tikz}
% correct bad hyphenation here
\hyphenation{op-tical net-works semi-conduc-tor}
\DeclareGraphicsRule{.1}{mps}{*}{}


\begin{document}
%
% paper title
% can use linebreaks \\ within to get better formatting as desired
\title{Securing and Integrating an Intranet of Things\\ with a Smart Home Router}


% author names and affiliations
% use a multiple column layout for up to three different
% affiliations
\author{\IEEEauthorblockN{Fergus Leahy, Joseph Sventek, Paul Harvey}
\IEEEauthorblockA{School of Computing Science\\ University of Glasgow\\
Email: \{fergus.leahy, joseph.sventek\}@glasgow.ac.uk}
}

\maketitle


\begin{abstract}
The abstract goes here.
\end{abstract}

% no keywords

\section{Introduction}
The modern home is becoming increasingly filled with variety of connected devices, each providing a myriad of different and often overlapping services within the home. More recently, ``smart-appliances'' and the Internet of Things have began to enter our homes, attempting to digitize our already existing ``dumb-appliances'' and objects within the home. As these devices enter our homes in an often piecemeal fashion, bringing with them their own distinct ecosystems, protocols and standards, the user is faced with an increasingly difficult burden of managing this network of heterogeneous devices. Due to the sheer number and diversity of these devices, problems arise with respect to how these devices co-operate, as well as how to ensure the user's network and information remains secure against new and unanticipated threats.

Many existing devices present a severe lack of thoughtful integration into existing networks, infrastructure and the devices themselves. A common approach has been to integrate traditional power-hungry 802.11 WIFI chipsets and offer services directly to the Internet\cite{IETF_CORE,Xively} or connecting to a cloud service\cite{SmartThings,Twine}, thus gaining the benefits of anywhere access and scalable power/storage. However, this solution not only severely limits the lifetime of many battery operated Things, but it also opens up multiple points of failure by relying on such connectivity to the Internet or Cloud (reliability, security, privacy, data-ownership). This has already resulted in attacks similar to that of Stuxnet\cite{IoTWorm}. 

In this paper we present a solution to securing an Intranet of Things, taking advantage of a combination of symmetric and asymmetric cryptographic algorithms and primitives to enable efficient, secure and authenticated entry into a new network without shared secrets known a priori. Secondly, this paper demonstrates integrating the IoT into a state-of-the-art smart router, Homework\cite{HomeworkProject}, for enabling a dynamic and powerful closed loop of control without the need for external connectivity to the Internet or Cloud. 

Whilst previous work has demonstrated it's possible to adequately secure wireless sensor networks from a variety of attacks\cite{TinySec,TinyECC,MiniSec}, existing research has yet to create a complete solution to enable new devices to join an existing network without the need of a shared secret (pre-shared key)\cite{TinySec,MiniSec} or complex user interaction to transfer the network key\cite{MessageBottle}.

The main contributions of this paper are as follows:
\begin{itemize}
  \item A port of IoT protocol to TinyOS, previously implemented on the Contiki and Arduino platforms.
  \item A secure Intranet of Things protocol, enabling new devices to securely join an existing network without a pre-shared key, providing authentication, end-to-end secrecy, replay and man-in-the-middle protection between Things within the network. 
  \item Homework Database Cache integration, a Java-based proxy enabling the IoT to communicate with a stream database, publish/subscribe engine and automata, to provide a closed loop of interaction.
\end{itemize}

\section{Background} % (fold)
\label{sec:background}

\subsection{Internet of Things Protocols} % (fold)
\label{sub:internet_of_things_protocols}
In our previous research\cite{KNoT}, existing protocols for traditional connectivity, domotics and IoTs were found to be inadequate for the typical IoT architecture and the types of devices it's designed to run on i.e. low power embedded devices. Existing protocols either cast a Thing to fit into the traditional RESTful client-server architecture\cite{IETF_COAP_HTTP}, are Cloud orientated\cite{SmartThings,Twine}, are extremely inefficient\cite{xAP} or are simply too heavyweight for such low power and constrained devices (TCP/IP), where battery power is a scarce resource. 

To remedy this, a model for the typical IoT was created consisting of sensors and actuators, as well as controllers which orchestrated the network. On top of this model a lightweight and efficient protocol was designed and implemented for the Contiki operating system, ensuring robust, low power and scalable networking is possible with a network of Things ranging from many tens to hundreds of devices.
% subsection internet_of_things_protocols (end)

\subsection{Smart Home Router} % (fold)
\label{sub:integration}
Homework Cache \cite{InformationPlane} \cite{DEBSChallenge}
% subsection integration (end)

% section background (end)

\section{Motivation} % (fold)
\label{sec:motivation}
\subsection{Security} % (fold)
\label{sub:security}
Deployable security in wireless sensor networks continues to be a significant problem for several reasons. Firstly, power is a major concern in WSNs; thus, running expensive conventional cryptography algorithms in order to keep transmitted data secret can be detrimental to the lifetime of a node. Secondly, WSN nodes are also extremely constrained in terms of memory (ROM/RAM), requiring cryptography algorithms to fit within extreme size constraints and is especially problematic when trying to reduce computational load by storing pre-computed tables. Lastly, being able to dynamically add new nodes to a network post-deployment as well as (re)distribute keys for the network, enables the network to scale, replace failed nodes and protect against attackers with ease. Previous work has demonstrated various solutions to the first and second part of this problem\cite{TinySec,MiniSec,TinyECC}, but have largely ignored the third part, assuming that keys or shared secrets are distributed at install time.

The first key problem this paper attempts to solve is securing the IoT in a usable manner to ensure the user's devices, network and data are secure against possible attacks and also allow new approved devices join the network with minimal effort. Due to the scale of an IoTs network, containing potentially tens if not hundreds of devices, this needs to be possible without the user being required to manually configure each device with a security key.

In the context of the IoT, security is of paramount importance due to the rich and sensitive nature of the data that sensors gather, as well as the level of control available from actuators, which, if compromised by any one of the attacks below, could pose serious health and safety risks for the user and home.

\textit{Types of Attack:}
\begin{itemize}
  \item Eavesdropping - An attacker can overhear messages broadcast by nodes in the network, using the information learned to potentially perform a physical attack (when house doors are unlocked), or log for later analysis (activity monitoring).  
  \item Masquerading - An attacker masquerades as a legitimate node within the network and is able to inject packets into the network and abuse the closed loop of control within the network with potentially dangerous consequences e.g., transmit cold temperature readings to trick the boiler to increase the temperature.
  \item Man-in-the-middle - An attacker intercepts a communications between two nodes and is able to overhear, manipulate and inject packets without either node detecting it. 
  \item Replay - An attacker records messages between nodes in the network and rebroadcasts them in an attempt to manipulate the network. This attack can be performed even if packets are encrypted. 
  \item Denial of service - An attacker abuses the resources available on a node by overwhelming it with expensive operations e.g., verifying a certificate.
  \item Node Capture - An attacker captures a node and can retrieve any data/keys stored on the device, potentially compromising the security of the network.
\end{itemize}

% subsection security_aims (end)
\subsection{Integration} % (fold)
\label{sub:integration_aims}
The second problem this paper presents is that existing commercial IoTs are trapped within manufacturer eco-systems, with each device connecting directly to the Internet or a Cloud service to enable functionality, unable to communicate directly to other Things within the local network. Whilst the previous work in developing an IoT protocol was successful in demonstrating a network of Things communicating directly with one another, it was limited to only operate within the constraints controller device, which orchestrates the network; thus, to create a more powerful IoTs network, integrating the controller role into a PC service which is able to receive, aggregate, process and react to events in a dynamic and configurable manner is necessary.
% subsection integration_aims (end)
% section design_goals  (end)

\section{Design} % (fold)
\label{sec:design}
\subsection{Assumptions} % (fold)
\label{sub:assumptions}
In designing the security protocol several assumptions are made:
\begin{itemize}
  \item The controller in the network has sufficient resources available to process and store a large number of public keys for nodes within the network.
  \item The controller has sufficient resources available to generate and store secure pair-wise session keys for each node in the network.  
  \item The network is deployed over a geographically small enough area, the home, such that it's unnecessary to perform packet gathering and compression between the source sensor and sink controller. Thus, intermediary nodes need not store keys for each of the surrounding nodes and can, if necessary, forward any encrypted packets received towards their destination.
  \item As the majority of nodes deployed in an IoT are situated within a secure property e.g., the home or office, and due to the increased cost of tamper-proofing them, node capture is not deemed to be a significant issue and will not be mitigated against in this security protocol. However, due to the use of pair-wise session keys being used between the nodes and controller, the risk presented by node capture is substantially lowered.
\end{itemize}
% subsection assumptions (end)

\subsection{Hardware and Software Platforms} % (fold)
\label{sec:hardware_and_software_platforms}
Whilst many newer and more powerful sensor platforms are available today, much of the existing work for WSNs and WSN security has been developed for the TelosB mote, a 8Mhz TI MSP430 microcontroller with 48KB ROM and 10KB RAM, due to its low power operation and TinyOS support. TinyOS is a lightweight operating system designed for embedded devices in WSNs and has strong support in academia, with many libraries and tools available. 

The IoT protocol previously discussed was developed for the Contiki operating system running on TelosB motes due to Contiki's relative similarity with imperative style programming, as opposed to TinyOS's event style programming. However, due to the number of security implementations available for TinyOS, including MiniSec and TinyECC, the IoT protocol will need to be ported across to TinyOS. 

\subsection{Security} % (fold)
\label{sub:security}
In this section we present the design of our security protocol, enabling new devices to join the network without the need of a shared secret or any physical interaction with the controller.
As discussed later in section \ref{sec:related_work} there are many existing security protocols available for TinyOS: including TinySec\cite{TinySec} and MiniSec\cite{MiniSec} for symmetric cryptography and TinyECC\cite{TinyECC} for asymmetric cryptography, as well as a variety of other key distribution schemes\cite{TinyPK,TinyPBC,Shi2013235,ContikiSec,MessageBottle,CertificatePairwise,MizanurRahman2010858}. The security protocol design we propose does not claim to demonstrate a completely new protocol, but is instead a novel combination of the previously described work, MiniSec and TinyECC, based on a conventional security algorithm, Transport Layer Security algorithm (TLS), commonly used in desktop machines today.

As described in section \ref{sec:motivation}, the key problem with previous approaches to WSN security is either the assumption that a shared secret, key or ID is pre-installed onto some or all of the nodes and thus not an issue, or the structure of the network is planned and predetermined, with designated high power nodes. However, this is impractical for networks containing many tens of nodes, entering in a piecemeal fashion and for administration by a novice user expecting device installation to be trivial. Thus, a secure key distribution method must be devised to ensure new nodes can join the network without the need to be reprogrammed.

To solve this problem we propose the following security protocol design described below and in figure \ref{fig:sequence_diagram}. Our design attempts to alleviate complex physical interactions between devices performed by the user\cite{MessageBottle} and remove the need to design and configure the network, which for the average home user would be non-trivial. Later sections \ref{sec:asymmetric_security} and \ref{sec:symmetric_security}, describe the choices made in designing this protocol.
\begin{enumerate}
  \item [0)] Bootstrap nodes with Public/Private key pair, public key certificate and the CA's public key.
  \item Initiate discovery mode on the node; node now accepts and verifies incoming certificate requests.
  \item Initiate query on controller; controller sends a broadcast query with its public key certificate.
  \item The sensor receives the request with the certificate, verifies the authenticity of it using the CA public key and if successful it sends a response with its own certificate.
  \item The controller receives the response with the sensor's certificate, verifies the authenticity of it using the CA public key and replies with an acknowledgement.
  \item The sensor receives the response ack, generates a random nonce value (to protect against replay attacks), then encrypts it with the controller's public and signs it with its own private key before sending it to the controller.
  \item The controller receives the signed and encrypted nonce. It first verifies the signature, if invalid it can either request the nonce again or abort the key exchange and waste no further resources. Otherwise it then decrypts the nonce value. The controller then generates a new symmetric key, encrypts it and the nonce with the sensor's public key and signs with its own private key.
  \item The sensor receives the signed and encrypted key and nonce. It first verifies the signature, if invalid it can either request the key response again or abort the key exchange. Otherwise it then decrypts the key and nonce value, verifying that the nonce is equal to the one it sent earlier, confirming the key response has not been replayed. Using the symmetric key, the sensor then initialises the symmetric encryption code and then sends a handover message to the controller to signal it received the key and is ready to communicate using it.
  \item The controller then receives the symmetric handover message and replies with an acknowledge. The two devices can now communicate securely.
\end{enumerate} 

\begin{figure}[h!]
\begin{center}
\input{./images/sequence.tex}
\caption{Security protocol sequence diagram}
\label{fig:sequence_diagram}
\end{center}
\end{figure}

\subsection{Integration} % (fold)
\label{sub:design_integration}
TODO: discuss architecture \ref{fig:architecture} of IoT, proxy, Homework and use of automata to react to the network

\begin{figure}[h!]
\centering
\includegraphics[scale=0.25]{../proposal/images/homework_proxy.1}
\caption{Integration architecture between IoT, the proxy and Homework}
\label{fig:architecture}
\end{figure}

% subsection design_integration (end)

\section{Asymmetric Security} % (fold)
\label{sec:asymmetric_security}
\subsection{TinyECC} % (fold)
\label{sub:tinyecc}


To enable secure key distribution, asymmetric cryptography provided by elliptic curve cryptography (ECC) using TinyECC\cite{TinyECC} will be used. Whilst TinyECC demonstrates the feasibility of using software based public key cryptography via ECC on low power microcontrollers, it is still extremely expensive in respect to code size (\textgreater15KB), RAM utilisation (3KB) and operational speed, taking up to 5 seconds per operation. Therefore, it's necessary to use it as little as possible and switch over to the far cheaper symmetric key cryptography to keep the connection secure for the rest of its lifetime, in which encrypt and decrypt operations takes \textless 2ms.
% subsubsection tinyecc (end)

\subsection{Denial of service protection} % (fold)
\label{sub:denial_of_service_protection}
Because of the significant cost in verifying a certificate, it would be possible for an attacker to perform a denial of service attack on a node by sending it fake certificates. To reduce the severity of this attack, Things in the network will only accept and process asymmetric packets throughout a set window of time after the user presses a button on the device. This also provides demonstrative identification for the user, enabling them to physically control and understand which devices are communicating.
% subsection denial_of_service_protection (end)

\subsection{Man-in-the-middle protection} % (fold)
\label{sub:man_in_the_middle_protection}

However, using TinyECC alone will not ensure authentication and won't protect against man-in-the-middle attacks. To perform authentication we propose the use of an offline trusted certificate authority to create public key certificates for nodes. These certificates are then installed on the nodes at compile time along with the nodes private/public key pair and the CA's public key.This enables new nodes to have their public key certificate authenticated by other nodes using the CA's public key, before the node's respective public keys are used to exchange the key.

After the nodes have verified each other's authenticity, they are then able to exchange the symmetric key in secret using asymmetric encryption and decryption, followed by handing the connection over to use just symmetric cryptography. 

% subsection man_in_the_middle_protection (end)
\subsection{Optimisations} % (fold)
\label{sub:optimisations}

% subsection optimisations (end)
To enable ECC to operate within reasonable time bounds on microcontroller platforms, such as the TelosB mote, various optimisations were made in TinyECC, which use precomputed tables and values created at initialisation to speed up the cryptographic operations. When using TinyECC to perform encryption and authentication, the state computed by these operations overlaps, requiring re-initialisation between operations. To reduce this overhead, we implemented state saving and switching, requiring initialisation to be performed only once for each encryption and authentication modules, saving valuable seconds over the entire key exchange. The benefits are further detailed in the evaluation in section \ref{sec:evaluation}.

\section{Symmetric Security} % (fold)
\label{sec:symmetric_security}
\subsection{Block cipher algorithm and mode of operation} % (fold)
\label{sub:cipher_block_algorithm_and_mode_of_operation}
After the handover has occurred, symmetric cryptography will be used to keep the connection secure for the duration of its lifetime. The symmetric cryptography used is based on the MiniSec implementation ported from Rogoway et al's OCB\cite{OCB} and Law et al's Skipjack\cite{Skipjack} implementations. However, due to the inadequacy of various parts of the extended implementation by MiniSec\cite{MiniSecLink}, including being written for TinyOS 1.0, allowing only one encrypted connection per node, various memory allocation bugs and inefficient IV synchronisation, much of the code was rewritten to be work correctly and more efficiently for TinyOS 2.1. 
% subsection cipher_block_algorithm_and_mode_of_operation (end)

\subsection{Man-in-the-middle and Masquerading protection} % (fold)
\label{sub:man_in_the_middle_and_masquerading_protection}
Similar to the asymmetric component of the protocol, to prevent man-in-the-middle and masquerading attacks, authentication is necessary, ensuring that a message sent from a Thing in the network is genuine and hasn't been tampered with in transit. To do this a message authentication code (MAC) block needs to be generated from the encrypted data. Unlike cipher block chaining (CBC) and CBC message authentication code (CBC-MAC), which encrypt/decrypt and authenticate the data independently using two unique keys; by using the offset code book (OCB) mode of operation for block ciphering, both encryption/decryption and authentication are completed in one pass over the data using just one key, realising a slight decrease in time\cite{ContikiSec} and significant saving in space used for storing the key.
% subsection man_in_the_middle_and_masquerading_protection (end)

\subsection{Semantic security} % (fold)
\label{sub:semantic_security}
In order to ensure semantic security, in which duplicate packets don't encrypt to the same ciphertext, a 64-bit monotonically increasing initialisation vector (IV) is used for each connection. This would normally require the 64-bits IV to be transmitted to the receiving node, which is extremely costly when attached to each packet. However, using the last bits (LB) optimisation coined in MiniSec, we are able to just transmit the last n bits of the counter and with some resynchronisation logic on both ends, withstand packet loss of up to $2^n$ packets before resynchronisation occurs. In our protocol we chose to send the last 6 bits of the counter, due to sharing the byte with another field.
% subsection semantic_security (end)

When MiniSec was developed, Skipjack was chosen as the underlying block-cipher due to its efficient implementation and low memory footprint\cite{Skipjack}. However, Skipjack uses a maximum key length of 80-bits, which as of 2010 NIST classifies as insecure for long term use\cite{NIST}. As a temporary measure, the controller can choose to re-issue a new session key for each node after an arbitrary period of time.  
% section symmetric_security (end)


% subsection security (end)


\section{Integration} % (fold)
\label{sec:integration}
TODO: discuss implementation of proxy and automata
% section integration (end)

\section{Evaluation} % (fold)
\label{sec:evaluation}
Code size, ASym timings/optimisations.
% section evaluation (end)

\section{Related Work} % (fold)
\label{sec:related_work}
There has been a myriad of different attempts to efficiently secure WSNs \cite{TinySec,MiniSec,TinyECC,TinyPK,TinyPBC,Shi2013235,ContikiSec,MessageBottle,CertificatePairwise,MizanurRahman2010858}, however none matched the requirements of the IoT.

TinySec\cite{TinySec}, a symmetric cryptography library for TinyOS 1.0, was some of the first work developed for TinyOS to try and solve this security problem, intending to demonstrate that software-based cryptography was possible on constrained devices with a minimal power overhead, around 10\% for both encryption and authentication. To achieve this, TinySec was designed around WSNs extreme resource constraints, taking advantage of some of these constraints, such as the limited networking bandwidth, optimising the security primitives in order to reduce the security overhead added to each packet. One such optimisation was the use of a reduced initialisation vector for the cipher block chaining mode of operation, which combined several of the existing header fields and added a 2 byte counter, ensuring IVs wouldn't clash between nodes sending the same packet. Whilst the IV is significantly smaller than conventional security protocols, which would reduce time till IV reuse, TinySec argued that this wasn't an issue, demonstrating that using an average send rate of 1 packet per minute, IV reuse would not occur for 45 days.

MiniSec, another symmetric cryptography library for TinyOS 1.0 and a successor to TinySec, was created to further improve the security provided by TinySec, add replay prevention and also improve upon the minimal security overheads which TinySec achieved. To achieve the increase in security, MiniSec chose to increase the initialisation vector size from 2 bytes to 8 bytes, however, instead of transmitting the whole 8 bytes, MiniSec sends only the 3 last bits (LB) within the pre-existing packet length field, thus incurring no additional overhead on top of the normal TinyOS packet for the IV. To ensure the LB optimisation works correctly, both communicating nodes must maintain state for the counter and perform counter resynchronisation upon significant packet loss (\textgreater$2^3$ packets). This counter state is also used to ensure replay prevention, requiring all received packets to have a higher IV than the local state.\footnote{Whilst the MiniSec paper presented an efficient symmetric cryptography protocol design, the corresponding implementation provided at \cite{MiniSecLink} does not appear to function correctly (with various runtime issues) or implement the IV counter using the LB optimisation described.}

TinyECC paragraph \cite{TinyECC}

There are many other complex key distribution schemes which require hierarchical networks of devices \cite{MizanurRahman2010858,Shi2013235} and predetermined deployment strategies to enable efficient key distribution. \cite{MizanurRahman2010858} presents a solution for such a hierarchical network, consisting of a network of heterogeneous nodes, in which high power nodes store node IDs for surrounding low power nodes and provide authentication for the key exchange process between low power nodes using ECC. However, this scheme requires expensive high power nodes that need to have the low power node IDs stored ahead of time, and also need to be tamper resistant to protect against node capture, further increasing the cost. Another viable alternative, pairings-based key distribution schemes, such as TinyPBC\cite{TinyPBC}, provide efficient key pairings (\textless5s) but require nodes know each other's ID a priori, which can prove difficult to do with authentication. 

TODO: Discuss TinyPK  \cite{TinyPK}Message in bottle \cite{MessageBottle}


% section related_work (end)
\section{Conclusion}


\section{Future Work} % (fold)
\label{sec:future_work}

\begin{itemize}
  \item improve symmetric security (port AES)
  \item add internet connectivity securely
  \item implement on a wider range of devices
  \item port controller to PC to better support expensive PKC
\end{itemize}
% section future_work (end)

% conference papers do not normally have an appendix


% use section* for acknowledgement
\section*{Acknowledgment}


The authors would like to thank... many great peepz





% trigger a \newpage just before the given reference
% number - used to balance the columns on the last page
% adjust value as needed - may need to be readjusted if
% the document is modified later
%\IEEEtriggeratref{8}
% The "triggered" command can be changed if desired:
%\IEEEtriggercmd{\enlargethispage{-5in}}

% references section

% can use a bibliography generated by BibTeX as a .bbl file
% BibTeX documentation can be easily obtained at:
% http://www.ctan.org/tex-archive/biblio/bibtex/contrib/doc/
% The IEEEtran BibTeX style support page is at:
% http://www.michaelshell.org/tex/ieeetran/bibtex/
%\bibliographystyle{IEEEtran}
% argument is your BibTeX string definitions and bibliography database(s)
%\bibliography{IEEEabrv,../bib/paper}
%
% <OR> manually copy in the resultant .bbl file
% set second argument of \begin to the number of references
% (used to reserve space for the reference number labels box)
\bibliographystyle{./sty/IEEEtran}
\bibliography{./sty/examples/IEEEabrv,bibliography}




% that's all folks
\end{document}


% An example of a floating figure using the graphicx package.
% Note that \label must occur AFTER (or within) \caption.
% For figures, \caption should occur after the \includegraphics.
% Note that IEEEtran v1.7 and later has special internal code that
% is designed to preserve the operation of \label within \caption
% even when the captionsoff option is in effect. However, because
% of issues like this, it may be the safest practice to put all your
% \label just after \caption rather than within \caption{}.
%
% Reminder: the "draftcls" or "draftclsnofoot", not "draft", class
% option should be used if it is desired that the figures are to be
% displayed while in draft mode.
%
%\begin{figure}[!t]
%\centering
%\includegraphics[width=2.5in]{myfigure}
% where an .eps filename suffix will be assumed under latex, 
% and a .pdf suffix will be assumed for pdflatex; or what has been declared
% via \DeclareGraphicsExtensions.
%\caption{Simulation Results}
%\label{fig_sim}
%\end{figure}

% Note that IEEE typically puts floats only at the top, even when this
% results in a large percentage of a column being occupied by floats.


% An example of a double column floating figure using two subfigures.
% (The subfig.sty package must be loaded for this to work.)
% The subfigure \label commands are set within each subfloat command, the
% \label for the overall figure must come after \caption.
% \hfil must be used as a separator to get equal spacing.
% The subfigure.sty package works much the same way, except \subfigure is
% used instead of \subfloat.
%
%\begin{figure*}[!t]
%\centerline{\subfloat[Case I]\includegraphics[width=2.5in]{subfigcase1}%
%\label{fig_first_case}}
%\hfil
%\subfloat[Case II]{\includegraphics[width=2.5in]{subfigcase2}%
%\label{fig_second_case}}}
%\caption{Simulation results}
%\label{fig_sim}
%\end{figure*}
%
% Note that often IEEE papers with subfigures do not employ subfigure
% captions (using the optional argument to \subfloat), but instead will
% reference/describe all of them (a), (b), etc., within the main caption.


% An example of a floating table. Note that, for IEEE style tables, the 
% \caption command should come BEFORE the table. Table text will default to
% \footnotesize as IEEE normally uses this smaller font for tables.
% The \label must come after \caption as always.
%
%\begin{table}[!t]
%% increase table row spacing, adjust to taste
%\renewcommand{\arraystretch}{1.3}
% if using array.sty, it might be a good idea to tweak the value of
% \extrarowheight as needed to properly center the text within the cells
%\caption{An Example of a Table}
%\label{table_example}
%\centering
%% Some packages, such as MDW tools, offer better commands for making tables
%% than the plain LaTeX2e tabular which is used here.
%\begin{tabular}{|c||c|}
%\hline
%One & Two\\
%\hline
%Three & Four\\
%\hline
%\end{tabular}
%\end{table}


% Note that IEEE does not put floats in the very first column - or typically
% anywhere on the first page for that matter. Also, in-text middle ("here")
% positioning is not used. Most IEEE journals/conferences use top floats
% exclusively. Note that, LaTeX2e, unlike IEEE journals/conferences, places
% footnotes above bottom floats. This can be corrected via the \fnbelowfloat
% command of the stfloats package.

